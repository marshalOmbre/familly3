// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String       @id @default(uuid())
  email     String       @unique
  password  String
  name      String?
  trees     FamilyTree[]
  createdAt DateTime     @default(now())
}

model FamilyTree {
  id          String   @id @default(uuid())
  name        String
  description String?
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  people      Person[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Person {
  id         String     @id @default(uuid())
  treeId     String
  tree       FamilyTree @relation(fields: [treeId], references: [id])
  firstName  String
  lastName   String
  gender     String? // M, F, O
  birthDate  DateTime?
  deathDate  DateTime?
  birthPlace String?
  deathPlace String?
  bio        String?

  // Relations
  // For simplicity in self-referencing many-to-many, we use a separate Relationship model
  // But to make it easier to query "parents" and "children", we can also use explicit relations if we want.
  // However, a separate Relationship table is more flexible for "Spouse" vs "Parent/Child".

  relationshipsAsPerson1 Relationship[] @relation("Person1")
  relationshipsAsPerson2 Relationship[] @relation("Person2")

  media     Media[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Relationship {
  id   String @id @default(uuid())
  type String // PARENT_CHILD, SPOUSE

  person1Id String // Parent or Spouse 1
  person1   Person @relation("Person1", fields: [person1Id], references: [id])

  person2Id String // Child or Spouse 2
  person2   Person @relation("Person2", fields: [person2Id], references: [id])
}

model Media {
  id       String @id @default(uuid())
  url      String
  type     String // IMAGE, DOCUMENT
  personId String
  person   Person @relation(fields: [personId], references: [id])
}
